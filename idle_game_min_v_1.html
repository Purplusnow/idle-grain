
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Idle Grain v1.2 — cloud-sync</title>
<style>
  body { background: #0f172a; color: white; font-family: sans-serif; padding: 20px; }
  button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
  .green { background: green; color: white; border: none; }
</style>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithRedirect, GoogleAuthProvider, getRedirectResult, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC17xJK5XIYb02CQ_Ct1CjOBvhG-aAcA",
  authDomain: "purple-idle-grain.firebaseapp.com",
  projectId: "purple-idle-grain",
  storageBucket: "purple-idle-grain.appspot.com",
  messagingSenderId: "656984023401",
  appId: "1:656984023401:web:4664d1f27daee178bfddf8"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const provider = new GoogleAuthProvider();

let grain = 0;
let upgrades = { scarecrow: 0, tractor: 0 };
let userId = null;

function updateUI() {
  document.getElementById('grain').textContent = grain;
  document.getElementById('status').textContent = userId ? `Signed in as ${userId}` : "Not signed in";
  localStorage.setItem('offlineData', JSON.stringify({ grain, upgrades }));
}

document.getElementById('harvest').onclick = () => {
  grain++;
  updateUI();
};

document.getElementById('signin').onclick = () => {
  signInWithRedirect(auth, provider);
};

document.getElementById('signout').onclick = () => {
  signOut(auth);
  userId = null;
  updateUI();
};

getRedirectResult(auth).then(async (result) => {
  if (result && result.user) {
    userId = result.user.uid;
    const docRef = doc(db, "players", userId);
    const docSnap = await getDoc(docRef);
    if (docSnap.exists()) {
      const cloudData = docSnap.data();
      grain = cloudData.grain;
      upgrades = cloudData.upgrades;
    } else {
      await setDoc(docRef, { grain, upgrades });
    }
    updateUI();
  }
}).catch(console.error);

// Load local storage data if exists
const localData = localStorage.getItem('offlineData');
if (localData) {
  const parsed = JSON.parse(localData);
  grain = parsed.grain || 0;
  upgrades = parsed.upgrades || upgrades;
  updateUI();
} else {
  updateUI();
}
</script>
</head>
<body>
<h1>Idle Grain <small>v1.2 — cloud-sync</small></h1>
<div>
  <button id="signin" class="green">Sign in</button>
  <button id="signout">Sign out</button>
</div>
<p id="status">Not signed in</p>
<p>Grain: <span id="grain">0</span></p>
<button id="harvest">Harvest +1</button>
<p style="color:gray; font-size:12px;">최종 빌드: 2025-08-12 05:47:28 UTC</p>
</body>
</html>
